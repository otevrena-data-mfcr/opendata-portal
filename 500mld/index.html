<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title></title>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

  <style type="text/css">
    @font-face {
      font-family: "TeutonNormal";
      font-style: normal;
      font-weight: normal;
      src: url("assets/fonts/teutonnormal-webfont-hinting.woff") format("woff");
    }

    body {
      background-color: #fff;
      font-size: 12pt;
      font-family: Arial, sans-serif;
    }

    h1 {
      font-family: TeutonNormal, sans-serif;
    }

    h2 {
      font-family: TeutonNormal, sans-serif;
    }

    h3 {
      font-family: TeutonNormal, sans-serif;
      font-size: 1.2rem;
    }

    .shadow-1 {
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
    }

    .shadow-2 {
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23);
    }

    .shadow-3 {
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.19), 0 6px 6px rgba(0, 0, 0, 0.23);
    }

    .shadow-4 {
      box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);
    }

    .shadow-5 {
      box-shadow: 0 19px 38px rgba(0, 0, 0, 0.30), 0 15px 12px rgba(0, 0, 0, 0.22);
    }

    .box {
      background-color: #fff;
      z-index: 1;
      height: 80%;
      overflow:auto;
    }

    #chart-container {
      position: relative;
    }

    #chart {
      z-index: 10;
      position: relative;
    }

    #chart-container .number {
      font-family: TeutonNormal, sans-serif;
      position: absolute;
      top: 50%;
      left: 50%;
      margin-top: -50px;
      margin-left: -75px;
      font-size: 3rem;
      width: 150px;
      height: 150px;
      line-height: 50px;
      text-align: center;
    }

    #details-container .bar {
      height: 1vh;
      background-color: rgb(0, 157, 234);
    }

    #details-container .description {
      margin: 0;
    }

    .template {
      display: none;
    }

    .underline {
      position: relative;
    }

    .underline::before {
      content: " ";

      position: absolute;
      left: 10px;
      right: -15px;
      top: 0;
      bottom: -5%;

      z-index: -1;

      background-image: url("assets/img/underline.svg");
      /* TODO: replace >C.D image with own svg image */
      background-repeat: repeat-x;
      background-position: left 80%;
      background-size: auto 20%;

      animation-duration: 1s;
      animation-name: underlineAnimation;
      animation-timing-function: ease-in-out;
    }

    @keyframes underlineAnimation {
      from {
        right: 100%;
      }

      to {
        right: -15px;
      }
    }
  </style>

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>

  <script type="application/javascript">
    var data = [
      {
        name: "Přímá pomoc",
        value: 40,
        children: [
          { name: "Kompenzační bonus pro OSVČ", description: "Podpoříme OSVČ jednorázovým příspěvkem 1&nbsp;500&nbsp;Kč", value: 0 },
          { name: "Kompenzační bonus pro společníky malých s.r.o.", description: "Podpoříme OSVČ jednorázovým příspěvkem 1&nbsp;500&nbsp;Kč", value: 0 },
          { name: "Ošetřovné pro zaměstnance", description: "Podpoříme OSVČ jednorázovým příspěvkem 1&nbsp;500&nbsp;Kč", value: 0 },
          { name: "Ošetřovné pro OSVČ", description: "Podpoříme OSVČ jednorázovým příspěvkem 1&nbsp;500&nbsp;Kč", value: 0 },
          { name: "Antivirus", description: "Podpoříme OSVČ jednorázovým příspěvkem 1&nbsp;500&nbsp;Kč", value: 0 },
          { name: "Příspěvek pro obce", description: "Podpoříme OSVČ jednorázovým příspěvkem 1&nbsp;500&nbsp;Kč", value: 0 }
        ]
      },
      {
        name: "Úlevy na daních o odvodech",
        value: 15,
        children: [
          { name: "Liberační balíček I+II+III", description: "Podpoříme OSVČ jednorázovým příspěvkem 1&nbsp;500&nbsp;Kč", value: 10 },
          { name: "Zrušení daně z nabytí nemovitých věcí", description: "Podpoříme OSVČ jednorázovým příspěvkem 1&nbsp;500&nbsp;Kč", value: 20 },
          { name: "Protikrizový daňový balíček", description: "Podpoříme OSVČ jednorázovým příspěvkem 1&nbsp;500&nbsp;Kč", value: 30 },
        ]
      },
      {
        name: "Propad příjmů kvůli pandemii",
        value: 60,
        children: [
          { name: "Daňové příjmy", description: "Podpoříme OSVČ jednorázovým příspěvkem 1&nbsp;500&nbsp;Kč", value: 0 },
          { name: "Nedaňové příjmy", description: "Podpoříme OSVČ jednorázovým příspěvkem 1&nbsp;500&nbsp;Kč", value: 0 },
        ]
      },
      {
        name: "Vládní rozpočtová rezerva",
        value: 5,
        children: [
          { name: "Nákup ochranných prostředků a jiné výdaje v souvislosti s COVID-19", description: "Podpoříme OSVČ jednorázovým příspěvkem 1&nbsp;500&nbsp;Kč", value: 0 },
          { name: "Oddlužení nemocnic", description: "Podpoříme OSVČ jednorázovým příspěvkem 1&nbsp;500&nbsp;Kč", value: 0 },
        ]
      },
      {
        name: "Navýšení investic do rozvoje ekonomiky",
        value: 3,
        children: [
          { name: "SFDI", description: "Podpoříme OSVČ jednorázovým příspěvkem 1&nbsp;500&nbsp;Kč", value: 0 },
          { name: "Silnice II a III třídy", description: "Podpoříme OSVČ jednorázovým příspěvkem 1&nbsp;500&nbsp;Kč", value: 0 },
          { name: "Kůrovcová kalamita", description: "Podpoříme OSVČ jednorázovým příspěvkem 1&nbsp;500&nbsp;Kč", value: 0 },
        ]
      },
      {
        name: "Původní schodek",
        value: 15,
        children: [{ name: "Původní schodek rozpočtu", description: "", value: 0 }]
      },
      {
        name: "Ostatní",
        value: 38,
        children: [
          { name: "Obsluha státního dluhu", description: "Podpoříme OSVČ jednorázovým příspěvkem 1&nbsp;500&nbsp;Kč", value: 0 },
          { name: "Odměny", description: "Podpoříme OSVČ jednorázovým příspěvkem 1&nbsp;500&nbsp;Kč", value: 0 },
          { name: "Výdaje na sociální dávky", description: "Podpoříme OSVČ jednorázovým příspěvkem 1&nbsp;500&nbsp;Kč", value: 0 },
        ]
      },

    ];

    var backgroundColors = [
      'rgba(0,157, 234, 0.2)',
      'rgba(0,157, 234, 0.2)',
      'rgba(0,157, 234, 0.2)',
      'rgba(0,157, 234, 0.2)',
      'rgba(0,157, 234, 0.2)',
      'rgba(0,157, 234, 0.2)',
      'rgba(0,157, 234, 0.2)',
    ];
    var hoverBackgroundColors = [
      'rgba(0,157, 234, 1)',
      'rgba(0,157, 234, 1)',
      'rgba(0,157, 234, 1)',
      'rgba(0,157, 234, 1)',
      'rgba(0,157, 234, 1)',
      'rgba(0,157, 234, 1)',
      'rgba(0,157, 234, 1)',
    ];

    $(document).ready(function () {
      var ctx = document.getElementById('chart').getContext('2d');
      var chart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: data.map(function (item) { return item.name }),
          datasets: [{
            data: data.map(function (item) { return item.value }),
            backgroundColor: backgroundColors,
            hoverBackgroundColor: hoverBackgroundColors,
            borderColor: [
              '#fff'
            ],
            borderWidth: 2
          }]
        },
        options: {
          legend: {
            display: false,
            position: 'bottom'
          },
          animation: {
            animateRotate: false,
            animateScale: true
          },
          tooltips: {
            callbacks: {
              label: function (tooltipItem, data) {

                var dataset = data.datasets[tooltipItem.datasetIndex];
                var label = data.labels[tooltipItem.index] || '';

                if (label) {
                  label += ': ';
                }
                label += data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];
                label += " mld. Kč"
                return label;
              }
            }
          }
          // rotation: 0
        }
      });

      function openCategory(i, element) {

        chart.options.rotation = -(element._view.startAngle + element._view.endAngle) / 2 + chart.options.rotation;
        chart.data.datasets[element._datasetIndex].backgroundColor = backgroundColors.slice(0)
        chart.data.datasets[element._datasetIndex].backgroundColor[i] = hoverBackgroundColors[i];
        chart.update();


        var newTitle = $("#catTitle").clone(true);
        newTitle.text(data[i].name);
        newTitle.hide();
        $("#catTitle").before(newTitle);
        $("." + $("#catTitle").attr("class") + ":last").remove();
        newTitle.fadeIn(250);

        var categoryTpl = $("#categories .category.template").first();
        $("#categories .category").not(".template").remove();

        var categoryMax = data[i].children.reduce(function (acc, cur) { return Math.max(acc, cur.value) }, 0)
        data[i].children.forEach(function (category) {
          var categoryEl = categoryTpl.clone(true).removeClass("template");
          $(categoryEl).find(".title").text(category.name);
          $(categoryEl).find(".description").html(category.description);
          var width = Math.round(category.value / categoryMax * 100);
          $(categoryEl).find(".bar").css({ width: width + "%" });
          $("#categories").append(categoryEl);
        });
      }

      chart.options.onClick = function (event, elements) {
        var element = elements[0];
        if (!element || !element._view) return;
        var i = element._index;
        openCategory(i, element);
      }

      openCategory(0, chart.getDatasetMeta(0).data[0]);

      console.log(chart.getDatasetMeta(0).data[0]);
    })


  </script>

</head>

<body>

  <div class="container my-3">
    <div class="row">

      <div class="col-md-6">
        <div class="px-md-5">
          <div id="chart-container">
            <div class="number">500<br>mld.</div>
            <canvas id="chart" width="400" height="400"></canvas>
          </div>
        </div>
      </div>

      <div class="col-md-6" id="details-container">
        <h2 class="title mt-3 mb-3"><span id="catTitle" class="underline"></span></h2>
        <div class="box shadow-1 p-5" id="categories">
          <div class="category template mb-3">
            <h3 class="title"></h3>
            <div class="bar my-1" style="width:80%;"></div>
            <p class="description small"></p>
          </div>

        </div>
      </div>


    </div>
  </div>

</body>

</html>