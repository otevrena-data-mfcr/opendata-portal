---
title: Hledání v otevřených datech
layout: main
---

{% include hero.html title="Vyhledávání" %}

<div class="container-fluid search-results">

  <div class="mx-xl-5 px-xl-5">

    <ul class="nav nav-tabs mt-5" id="myTab" role="tablist">
      <li class="nav-item">
        <a class="nav-link active" id="home-tab" data-toggle="tab" href="#resultsPortal" role="tab" aria-controls="home" aria-selected="true">Vyhledávání na portálu otevřených dat<span id="resultsPortalCount" class="badge badge-inverse"></span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="profile-tab" data-toggle="tab" href="#resultsSparql" role="tab" aria-controls="profile" aria-selected="false">Vyhledávání v katalogu datových sad<span id="resultsSparqlCount" class="badge badge-inverse"></span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="contact-tab" data-toggle="tab" href="#resultsData" role="tab" aria-controls="contact" aria-selected="false">Vyhledávání v datech<span id="resultsDataCount" class="badge badge-inverse"></span></a>
      </li>
    </ul>


    <div class="tab-content p-3" id="myTabContent">

      <div class="tab-pane fade show active" id="resultsPortal">
        <div class="row mb-5">
          <div class="col-xl-6">
            <div class="results"></div>
          </div>
        </div>
      </div>

      <div class="tab-pane fade" id="resultsSparql">
        <div class="row mb-5">
          <div class="col-xl-6">
            <div class="results"></div>
          </div>
        </div>
      </div>

      <div class="tab-pane fade" id="resultsData">
        <div class="row mb-5">
          <div class="col-xl-6">
            <div class="results"></div>
          </div>
          <div class="col-xl-6 text-right">
            <div class="d-inline-block text-left">
              <p>Vyhledávání v datech prochází tyto datové sady:</p>
              <ul>
                <li><a href="https://opendata.mfcr.cz/catalog/#/iri/https%3A%2F%2Fopendata.mfcr.cz%2Flod%2Fkatalog%2Ff…financi-cr%2F649107b9-e2d8-4b47-92c5-024c6a200c0a">Faktury Ministerstva financí</a></li>
                <li><a href="https://opendata.mfcr.cz/catalog/#/iri/https%3A%2F%2Fopendata.mfcr.cz%2Flod%2Fkatalog%2Fs…znam-smluv%2Fbdcd22b4-3461-4978-b19d-e767c574255f">Smlouvy Ministerstva financí</a></li>
                <li><a href="https://opendata.mfcr.cz/catalog/#/iri/https%3A%2F%2Fopendata.mfcr.cz%2Flod%2Fkatalog%2Fo…objednavek%2Fc6c61e5a-27ef-4242-bde4-9a4f6b0388c1">Přehled objednávek Ministerstva financí</a></li>
                <li><a href="https://opendata.mfcr.cz/catalog/#/iri/https%3A%2F%2Fopendata.mfcr.cz%2Flod%2Fkatalog%2Fo…-cr-detail%2Fe0b462a5-5176-47ef-b831-02d9db7af58d">Přehled objednávek Ministerstva financí - detail</a></li>
                <li><a href="https://opendata.mfcr.cz/catalog/#/iri/https%3A%2F%2Fopendata.mfcr.cz%2Flod%2Fcedr%2FDotace%2Fcsv">CEDR - Dotace</a></li>
                <li><a href="https://opendata.mfcr.cz/catalog/#/iri/https%3A%2F%2Fopendata.mfcr.cz%2Flod%2Fcedr%2FPrijemcePomoci%2Fcsv">CEDR - Prijemce pomoci</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

</div>











<script type="text/javascript">

  function search(needle) {

    $("#resultsPortal").addClass("searching");
    $("#resultsPortal .results").html("");
    
    $("#resultsData").addClass("searching");
    $("#resultsData .results").html("");
    
    $("#resultsSparql").addClass("searching");
    $("#resultsSparql .results").html("");

    console.log("[search] loading data...");
    $.get("/search.json")
      .then(function (data) {

        console.log("[search] processing...");

        const options = {
          isCaseSensitive: false,
          includeScore: true,
          shouldSort: true,
          includeMatches: true,
          findAllMatches: false,
          minMatchCharLength: needle.length,
          // location: 0,
          threshold: 0.2,
          // distance: 100,
          // useExtendedSearch: false,
          ignoreLocation: true,
          // ignoreFieldNorm: false,
          keys: [
            { name: "title", weight: 10 },
            { name: "content", weight: 5 },
          ]
        };

        const fuse = new Fuse(data, options);

        console.log("[search] searching for " + needle);
        const results = fuse.search(needle);
        console.log("[search] found results: " + results.length);

        $("#resultsPortalCount").text(results.length);

        if (!results.length) {
          $("#resultsPortal .results").append($("<p />").text("Nebyly nalezeny žádné shody."));
          $("#resultsPortal").removeClass("searching");
          return;
        }

        results.forEach(function (result) {

          const resultEl = $("<div />").addClass("result");
          resultEl.append($("<h3 />").append($("<a />").attr("href", result.item.url).text(result.item.title)));

          const matches = [];
          result.matches.forEach(function (match) {
            match.indices.slice(0, 10).forEach(function (i) {
              matches.push(match.value.substring(i[0] - 20, i[0]).replace(/^\S+\s/, "") + "<em>" + match.value.substring(i[0], i[1] + 1) + "</em>" + match.value.substring(i[1] + 1, i[1] + 20).replace(/\s\S+$/, ""));
            });
          });

          resultEl.append($("<p />").html(matches.join(" &hellip; ")));

          $("#resultsPortal .results").append(resultEl);
        })

        $("#resultsPortal").removeClass("searching");

      })
      .catch(console.error);

    const sparqlQuery = `PREFIX dcat: <http://www.w3.org/ns/dcat#>
PREFIX dct: <http://purl.org/dc/terms/>

SELECT ?iri ?title ?description
WHERE
{
  ?iri a dcat:Dataset ; dct:title ?title .
  OPTIONAL { ?iri dct:description ?description . }
  FILTER ( REGEX(?title, "${needle.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')}", "i") || REGEX(?description, "${needle.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')}", "i")) .
  FILTER (LANG(?title) = "cs") .
}`;
    $.get("https://opendata.mfcr.cz/lod/sparql", { query: sparqlQuery }).then(function (data) {

      const matches = data.results.bindings.map(function (binding) {
        return { iri: binding.iri.value, title: binding.title.value, description: binding.description && binding.description.value };
      });

      $("#resultsSparqlCount").text(matches.length);

      if (!matches.length) {
        $("#resultsSparql .results").append($("<p />").text("Nebyly nalezeny žádné shody."));
        $("#resultsSparql").removeClass("searching");
        return;
      }

      matches.forEach(function (match) {
        const resultEl = $("<div />").addClass("result");
        resultEl.append($("<h3 />").append($("<a />").attr("href", "https://opendata.mfcr.cz/catalog/#/iri/" + encodeURIComponent(match.iri)).html(match.title.replace(new RegExp("(" + needle.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&') + ")", "ig"), "<em>$1</em>"))));
        resultEl.append($("<p />").html(match.description.replace(new RegExp("(" + needle.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&') + ")", "ig"), "<em>$1</em>")));

        $("#resultsSparql .results").append(resultEl);
      });

      $("#resultsSparql").removeClass("searching");

    });

    $.get("https://opendata.mfcr.cz/lod/search", { q: needle }).then(function (results) {

      const sources = {};

      results.forEach(function (result) {
        if (!sources[result.source.iri]) {
          sources[result.source.iri] = result.source;
          sources[result.source.iri].matches = [];
        }

        sources[result.source.iri].matches.push({
          index: result.index,
          property: result.property,
          value: result.value,
        })

      });

      $("#resultsDataCount").text(results.length === 100 ? results.length + "+" : results.length);

      if (!results.length) {
        $("#resultsData .results").append($("<p />").text("Nebyly nalezeny žádné shody."));
        $("#resultsData").removeClass("searching");
        return;
      }

      results.forEach(function (result) {

        const resultEl = $("<div />").addClass("result");
        resultEl.append($("<h3 />").append($("<a />").attr("href", "https://opendata.mfcr.cz/catalog/#/iri/" + encodeURIComponent(result.source.iri)).text(result.source.name)));

        let string = "<strong>Dokument č.</strong> " + result.index + ", <strong>Pole &bdquo;" + result.property + "&rdquo;</strong>: " + result.value.replace(new RegExp("(" + needle.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&') + ")", "ig"), "<em>$1</em>");

        resultEl.append($("<p />").html(string));

        $("#resultsData .results").append(resultEl);
      });

      $("#resultsData").removeClass("searching");
    });

  }

  const urlParams = new URLSearchParams(window.location.search);
  const needle = urlParams.get('q');

  $(".search input").val(needle);
  $("h1").text("Vyhledávání: " + needle);

  if (needle) search(needle);

</script>